<p-table
  [columns]="getColumns()"
  #dtTable
  [value]="tableData"
  dataKey="id"
  [rows]="10"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="[10,20,30,40,50]"
  [paginator]="true"
  currentPageReportTemplate="{first} - {last} de {totalRecords}"
  [globalFilterFields]="getGlobalFilterFields()"
>
  <ng-template pTemplate="caption">
    <div class="flex items-center justify-between mb-2 w-full">
      <!-- Buscar (izquierda) -->
      <div class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          id="buscarTabla"
          [formControl]="searchControl"
          pInputText
          type="text"
          (input)="onGlobalFilter($event)"
          placeholder="Buscar en la tabla"
        />
      </div>

      <!-- Botones alineados a la derecha -->
      <div class="flex items-center gap-2 ml-auto">
        <button *ngIf="shouldRenderDownloadButton()" pButton type="button" icon="pi pi-download"
                label="Generar Reporte"
                (click)="exportTableToExcel()"
                class="p-button-outlined p-button-sm">
        </button>

        <button pButton label="Limpiar filtros" class="p-button-outlined p-button-sm"
                icon="pi pi-filter-slash"
                (click)="clear(dtTable)">
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="header" let-columns>
    <tr>
      <th *ngFor="let col of columns" id="cols">
        <div class="flex align-items-center">
          {{ col.header }}

          <p-columnFilter
            *ngIf="col.hasFilter"
            [field]="col.field"
            [display]="col.displayType"
            [type]="col.filterType !== 'dropdown' && col.filterType !== 'date' ? col.filterType : null">

            <ng-container [ngSwitch]="getFilterTemplateType(col)">

              <!-- Filtro por dropdown -->
              <ng-template *ngSwitchCase="'dropdown'" pTemplate="filter" let-value let-filterCallback="filterCallback">
                <p-dropdown
                  [formControl]="dropdownsControl"
                  [options]="col.options"
                  (onChange)="filterCallback($event.value)"
                  placeholder="Todos">
                </p-dropdown>
              </ng-template>

              <!-- Filtro por fecha -->
              <ng-template *ngSwitchCase="'date'" pTemplate="filter" let-value let-filterCallback="filterCallback">
                <p-calendar
                  [formControl]="dateFormControl"
                  (onSelect)="filterCallback($event)"
                  dateFormat="dd/mm/yy"
                  placeholder="dd/mm/aa"
                  [showIcon]="true">
                </p-calendar>
              </ng-template>
            </ng-container>

          </p-columnFilter>

        </div>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rowData let-columns="columns">
    <tr>
      <td *ngFor="let col of columns">
        <!-- Si el campo es de tipo fecha -->
        <div *ngIf="isDateField(col.field)">
          {{ rowData[col.field] | date:'dd/MM/yyyy' }}
        </div>

        <!-- Si el campo NO es estado, acciones ni fechas -->
        <div *ngIf="!isDateField(col.field) && col.field !== 'estado' && col.field !== 'acciones'">
          {{ rowData[col.field] }}
        </div>

        <!-- Estado -->
        <span *ngIf="col.field === 'estado'"
              class="px-2 py-1 rounded-full text-sm font-medium"
              [ngClass]="getEstadoClass(rowData.estadoTipo)">
        {{ rowData.estado }}
      </span>

        <!-- Acciones -->
        <div class="flex items-center gap-2 justify-center">
          <ng-container *ngFor="let action of getColumnActions(col, rowData)">
            <button
              pButton
              class="p-button-text p-button-sm"
              [icon]="action.icon"
              (click)="action.clickHandler()">
              {{ action.label }}
            </button>
          </ng-container>
        </div>
      </td>
    </tr>
  </ng-template>

</p-table>
